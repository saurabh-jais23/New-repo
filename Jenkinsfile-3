pipeline {
  agent any
  stages {
        stage('Generate Files on Source Node') {
            agent {
                label 'windows'  // Node where files will be generated
            }
            steps {
                script {
                    
                    sh 'scp -o StrictHostKeyChecking=no c:\\ProgramData\\CB\\workspace\\Pipeline\\bin\\Release\\*.TapPackage jenkins@c69-ubu0011-bld-p705xacbci-ssh:/home/kpclocal/jenkins/workspace/AnsibleProject/'  // Copy file to agent node
                }
            }
        }


  
stage('Install Dependencies') {
agent { label 'ubuntu' }
            steps {
                // Install Python, pip, and other required dependencies
                sh '''
                    sudo apt-get update
                    sudo apt-get install -y python3 python3-venv python3-pip
                '''
            }
        }

        stage('Install WinRM and Python Modules') {
          agent { label 'ubuntu' }
            steps {
                // Install WinRM and required Python packages
                sh '''
                   
                    pip install --upgrade pip  # Upgrade pip
                    pip install pywinrm requests  # Install pywinrm and requests
                '''
            }
        }
    

      stage('Hello') {
      agent { label 'ubuntu' }
      steps {
        sh 'ansible-playbook -i winhosts2.ini copy_to_win.yml'
      }
    }
  }
}
